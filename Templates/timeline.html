{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home / X</title>
    <link rel="stylesheet" href="{% static 'timeline.css' %}">
    <link rel="stylesheet" href="{% static 'profile_page.css' %}">

</head>
<body>
    <div class="container">
        <!-- Left Sidebar -->
        <nav class="sidebar">
            <svg viewBox="0 0 24 24" class="logo">
                <g><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"><span>C</span></path></g>
            </svg>
            <a href="#" class="nav-item">
                <svg viewBox="0 0 24 24"><g><path d="M12 1.696L.622 8.807l1.06 1.696L3 9.679V19.5C3 20.881 4.119 22 5.5 22h13c1.381 0 2.5-1.119 2.5-2.5V9.679l1.318.824 1.06-1.696L12 1.696zM12 16.5c-1.933 0-3.5-1.567-3.5-3.5s1.567-3.5 3.5-3.5 3.5 1.567 3.5 3.5-1.567 3.5-3.5 3.5z"></path></g></svg>
                <span>Home</span>
            </a>
            <a href="#" class="nav-item">
                <svg viewBox="0 0 24 24"><g><path d="M10.25 3.75c-3.59 0-6.5 2.91-6.5 6.5s2.91 6.5 6.5 6.5c1.795 0 3.419-.726 4.596-1.904 1.178-1.177 1.904-2.801 1.904-4.596 0-3.59-2.91-6.5-6.5-6.5zm-8.5 6.5c0-4.694 3.806-8.5 8.5-8.5s8.5 3.806 8.5 8.5c0 1.986-.682 3.815-1.824 5.262l4.781 4.781-1.414 1.414-4.781-4.781c-1.447 1.142-3.276 1.824-5.262 1.824-4.694 0-8.5-3.806-8.5-8.5z"></path></g></svg>
                <span>Explore</span>
            </a>
            <a href="#" class="nav-item">
                <svg viewBox="0 0 24 24"><g><path d="M19.993 9.042C19.48 5.017 16.054 2 11.996 2s-7.49 3.021-7.999 7.051L2.866 18H7.1c.463 2.282 2.481 4 4.9 4s4.437-1.718 4.9-4h4.236l-1.143-8.958zM12 20c-1.306 0-2.417-.835-2.829-2h5.658c-.412 1.165-1.523 2-2.829 2zm-6.866-4l.847-6.698C6.364 6.272 8.941 4 11.996 4s5.627 2.268 6.013 5.295L18.864 16H5.134z"></path></g></svg>
                <span>Notifications</span>
            </a>
            <a href="#" class="nav-item">
                <svg viewBox="0 0 24 24"><g><path d="M1.998 5.5c0-1.381 1.119-2.5 2.5-2.5h15c1.381 0 2.5 1.119 2.5 2.5v13c0 1.381-1.119 2.5-2.5 2.5h-15c-1.381 0-2.5-1.119-2.5-2.5v-13zm2.5-.5c-.276 0-.5.224-.5.5v2.764l8 3.638 8-3.636V5.5c0-.276-.224-.5-.5-.5h-15zm15.5 5.463l-8 3.636-8-3.638V18.5c0 .276.224.5.5.5h15c.276 0 .5-.224.5-.5v-8.037z"></path></g></svg>
                <span>Messages</span>
            </a>
            <button class="post-btn" id="posttweetbutton">Post</button>
            <a href="{% url 'login_email'%}" ><button id="signinbutton" class="post-btn2">Sign In</button></a>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <header class="header">
                Home
            </header>

            <div class="tweet-box">
                <div class="avatar"></div>
                <div class="tweet-input">
                    <textarea placeholder="What's happening?" id="tweetContent"></textarea>
                    <div class="tweet-actions">
                        <div class="tweet-icons">
                            <svg viewBox="0 0 24 24"><g><path d="M3 5.5C3 4.119 4.119 3 5.5 3h13C19.881 3 21 4.119 21 5.5v13c0 1.381-1.119 2.5-2.5 2.5h-13C4.119 21 3 19.881 3 18.5v-13zM5.5 5c-.276 0-.5.224-.5.5v9.086l3-3 3 3 5-5 3 3V5.5c0-.276-.224-.5-.5-.5h-13zM19 15.414l-3-3-5 5-3-3-3 3V18.5c0 .276.224.5.5.5h13c.276 0 .5-.224.5-.5v-3.086zM9.75 7C8.784 7 8 7.784 8 8.75s.784 1.75 1.75 1.75 1.75-.784 1.75-1.75S10.716 7 9.75 7z"></path></g></svg>
                            <svg viewBox="0 0 24 24"><g><path d="M3 5.5C3 4.119 4.12 3 5.5 3h13C19.88 3 21 4.119 21 5.5v13c0 1.381-1.12 2.5-2.5 2.5h-13C4.12 21 3 19.881 3 18.5v-13zM5.5 5c-.28 0-.5.224-.5.5v13c0 .276.22.5.5.5h13c.28 0 .5-.224.5-.5v-13c0-.276-.22-.5-.5-.5h-13zM18 10.711V9.25h-3.74v5.5h1.44v-1.719h1.7V11.57h-1.7v-.859H18zM11.79 9.25h1.44v5.5h-1.44v-5.5zm-4.5 0h1.44v5.5H7.29v-5.5z"></path></g></svg>
                            <svg viewBox="0 0 24 24"><g><path d="M6 5c-1.1 0-2 .895-2 2s.9 2 2 2 2-.895 2-2-.9-2-2-2zM2 7c0-2.209 1.79-4 4-4s4 1.791 4 4-1.79 4-4 4-4-1.791-4-4zm20 1v2h-2V8h2zm-2-2v2h-2V6h2zm-2-2v2h-2V4h2zm-2-2v2h-2V2h2zM6 17c-1.1 0-2 .895-2 2s.9 2 2 2 2-.895 2-2-.9-2-2-2zm-4 2c0-2.209 1.79-4 4-4s4 1.791 4 4-1.79 4-4 4-4-1.791-4-4zm19 1v2h-2v-2h2zm-2-2v2h-2v-2h2zm-2-2v2h-2v-2h2zm-2-2v2h-2v-2h2z"></path></g></svg>
                            <svg viewBox="0 0 24 24"><g><path d="M8 9.5C8 8.119 8.672 7 9.5 7S11 8.119 11 9.5 10.328 12 9.5 12 8 10.881 8 9.5zm6.5 2.5c.828 0 1.5-1.119 1.5-2.5S15.328 7 14.5 7 13 8.119 13 9.5s.672 2.5 1.5 2.5zM12 16c-2.224 0-3.021-2.227-3.051-2.316l-1.897.633c.05.15 1.271 3.684 4.949 3.684s4.898-3.533 4.949-3.684l-1.896-.638c-.033.095-.83 2.322-3.053 2.322zm10.25-4.001c0 5.652-4.598 10.25-10.25 10.25S1.75 17.652 1.75 12 6.348 1.75 12 1.75 22.25 6.348 22.25 12zm-2 0c0-4.549-3.701-8.25-8.25-8.25S3.75 7.451 3.75 12s3.701 8.25 8.25 8.25 8.25-3.701 8.25-8.25z"></path></g></svg>
                            <svg viewBox="0 0 24 24"><g><path d="M6 3V2h2v1h6V2h2v1h1.5C18.88 3 20 4.119 20 5.5v2h-2v-2c0-.276-.22-.5-.5-.5H16v1h-2V5H8v1H6V5H4.5c-.28 0-.5.224-.5.5v12c0 .276.22.5.5.5h3v2h-3C3.12 20 2 18.881 2 17.5v-12C2 4.119 3.12 3 4.5 3H6zm9.5 8c-2.49 0-4.5 2.015-4.5 4.5s2.01 4.5 4.5 4.5 4.5-2.015 4.5-4.5-2.01-4.5-4.5-4.5zM9 15.5C9 11.91 11.91 9 15.5 9s6.5 2.91 6.5 6.5-2.91 6.5-6.5 6.5S9 19.09 9 15.5zm5.5-2.5h2v2.086l1.71 1.707-1.42 1.414-2.29-2.293V13z"></path></g></svg>
                        </div>
                        <button class="tweet-btn" id="mini-tweet-button">Post</button>
                    </div>
                </div>
            </div>

            <div id="tweetcontainer">
                <div class="post" id="1">
                    <!-- <div class="post-avatar"></div> -->
                    <div class="post-content">
                        <div class="post-header"> <div class="post-avatar"></div>
                            <span class="post-name">Crystal Mind</span>
                            <span class="post-handle" id="tweetusername" >@benar_m</span>
                            <span class="post-time">路 2h</span>
                        </div>
                        <div class="post-text" id="tweettext">
                            Excited to share my latest AI project! Check it out and let me know what you think  #AI #Technology
                        </div>
                        <div class="post-actions">
                            <button type="submit" id="commentbutton" class="actionbuttons"> <span> 12</span></button>
                            <!-- Comment Section -->
                            <div class="comment-modal" id="commentModal">
                                <div class="modal-content">
                                    <span class="close">&times;</span>
                                    <h3>Reply to Tweet</h3>
                                    <textarea placeholder="Tweet your reply..." id="commentInput"></textarea>
                                    <button id="postComment">Reply</button>
                                </div>
                            </div>

                            <!-- Tweet Actions continur.. -->
                            <button type="submit" id="retweetbutton" class="actionbuttons"><span> 48</span></button>
                            <button type="submit" id="likebutton" class="actionbuttons"><span id="heartmoji"> 136</span></button>
                            <span> 1.2K</span>
                        </div>
                    </div>
                </div>

        </main>

        <!-- Right Sidebar -->
        <aside class="trending">
            <div class="search-bar">
                <input type="text" placeholder="Search">
            </div>
            <div class="trending-card">
                <h2 class="trending-header">What's happening</h2>
                <div class="trending-item">
                    <div class="trending-category">Technology 路 Trending</div>
                    <div class="trending-title">#WebDevelopment</div>
                    <div class="trending-tweets">10.5K posts</div>
                </div>
                <div class="trending-item">
                    <div class="trending-category">Sports 路 Trending</div>
                    <div class="trending-title">World Cup</div>
                    <div class="trending-tweets">52.8K posts</div>
                </div>
                <div class="trending-item">
                    <div class="trending-category">Entertainment 路 Trending</div>
                    <div class="trending-title">New Movie Release</div>
                    <div class="trending-tweets">35.2K posts</div>
                </div>
            </div>
        </aside>
    </div>
</body>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const tweetsContainer = document.getElementById('tweetcontainer');
    
    // Event delegation for like buttons
    tweetsContainer.addEventListener('click', function(e) {
        if (e.target.matches('.heartmoji')) {
            const tweetId = e.target.closest('.post').id;
            const likeEndpoint = `/tweet/like/${tweetId}/`;
            
            if (e.target.innerHTML.includes('わ')) {
                e.target.innerHTML = ` ${e.target.innerHTML.split(' ')[1]}`;
                fetch(likeEndpoint, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
            } else {
                e.target.innerHTML = `わ ${e.target.innerHTML.split(' ')[1]}`;
                fetch(likeEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
            }
        }
    });
    function getCookie(name) {
    let cookieArr = document.cookie.split(';');
    for (let i = 0; i < cookieArr.length; i++) {
        let cookie = cookieArr[i].trim();
        if (cookie.startsWith(name + '=')) {
            return cookie.substring(name.length + 1);
        }
    }
    return null;
    }
    const access_token=getCookie('access_token');
    const signinbutton=document.getElementById('signinbutton')
    const postbutton=document.getElementById('posttweetbutton')
    const minitweetbtn=document.getElementById('mini-tweet-button')
    if (access_token){
        //
    }else {
        console.log("elsing")
        signinbutton.style.display='block';
        postbutton.style.display='none';
        minitweetbtn.style.display='none'


    }

    postbutton.addEventListener('click', (e)=>{
        const creteTweetEndpoint='/tweet/create/'
        const tweetContent=document.getElementById('tweetContent')
        const content=tweetContent.value
        console.log(content)
        fetch(creteTweetEndpoint,{
            method:'POST',
            headers:{
                'content-Type': 'application/json',                
                'Authorization': `Bearer ${access_token}`,


            },
            body:JSON.stringify({content})
        })

    }
    )

    

    // Fetch tweets
    const tweet_endpoint = '/tweet/timeline/';
    fetch(tweet_endpoint, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        console.log('Raw response:', data);
        
        const tweets = data.results || [];
        
        if (tweets.length === 0) {
            tweetsContainer.innerHTML = '<div class="no-tweets">No tweets yet</div>';
            return;
        }
        
        tweetsContainer.innerHTML = '';
        tweets.forEach((tweet) => {
            const tweetElement = document.createElement('div');
            tweetElement.className = 'post';
            tweetElement.id = tweet.id;
            tweetElement.innerHTML = `
                <div class="post-content">
                    <div class="post-header"><div class="post-avatar"></div>
                        <span class="post-name">User ${tweet.user}</span>
                        <span class="post-handle">@user${tweet.user}</span>
                        <span class="post-time">路 ${tweet.created_at_human}</span>
                    </div>
                    <div class="post-text">${tweet.content}</div>
                    <div class="post-actions">
                        <button type="submit" class="actionbuttons"><span> 0</span></button>
                        <button type="submit" class="actionbuttons"><span> 0</span></button>
                        <button type="submit" class="actionbuttons"><span class="heartmoji"> 0</span></button>
                        <span> 0</span>
                    </div>
                </div>
            `;
            tweetsContainer.appendChild(tweetElement);
        });
    })
    .catch(error => {
        console.error('Error:', error);
        tweetsContainer.innerHTML = '<div class="error">Failed to load tweets</div>';
    });
});
</script>
</html>